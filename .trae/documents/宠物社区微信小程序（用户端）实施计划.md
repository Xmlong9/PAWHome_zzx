## 项目概述
- 目标：实现宠物信息交流平台微信小程序（用户端），覆盖社区交流、商品购买、宠物服务预约、个人中心四大模块，满足高并发、低时延与安全要求。
- 设计依据：严格对齐 MasterGo 设计稿（https://mastergo.com/file/146159509284961）与本地 UI 方案（f:\PAWHome\UI设计），功能范围参考任务书与论文资料（f:\PAWHome\论文）。

## 总体架构
- 前端：微信原生小程序 + TypeScript + Vant Weapp（按需引入），状态管理使用全局 `store`（基于 `Behavior`/事件总线）与页面级 `data`。
- 后端：Flask 微服务，按域拆分（认证与用户、社区、商品、订单、服务预约、消息通知），使用 Gunicorn + Nginx。
- 数据：MySQL（主存储，读写分离可扩展），Redis（会话、缓存、消息、限流），对象存储（图片/视频/CDN）。
- 实时能力：WebSocket（`wx.connectSocket`）用于私信与互动通知；后台使用 Flask-SocketIO + Redis Pub/Sub。
- 安全：JWT（小程序端持有短期令牌）、参数校验、防注入、限流、内容审核（文本/图片）、隐私与权限隔离。

## 前端实现
- 工程化
  - 项目结构：`app.ts`/`app.json`/`app.wxss`；`pages/*`、`components/*`、`services/*`、`store/*`、`utils/*`、`assets/*`。
  - TypeScript 配置与路径别名；统一请求封装（拦截器、重试、错误处理、埋点）。
  - UI库：Vant Weapp 按需引入（按钮、弹窗、标签、列表、表单、步骤条、Tabs、Badge 等）。
- 页面（TabBar 四页，与设计稿一致）
  - 社区（首页/话题/搜索/发布/详情/私信列表/聊天）
  - 商城（分类/搜索/商品列表/详情/购物车/订单列表与详情/退款）
  - 服务（疫苗、美容、医疗、寄养：项目列表/预约流程/记录与评价）
  - 我的（个人资料、宠物卡、关注/粉丝/获赞、内容管理、订单与预约、浏览历史、设置）
- 组件
  - 通用：`PostCard`、`MediaUploader`（图片/视频分片与秒传）、`TopicTag`、`UserBadge`、`ProductCard`、`SkuSelector`、`CartBar`、`AppointmentCard`、`PetCard`、`EmptyState`、`SkeletonList`。
- 交互与状态
  - 登录：`wx.login` + 后端 `code2Session` 绑定用户；支持手机号绑定与验证码登录备选。
  - 上传：`wx.uploadFile`，后端签名直传 COS/OSS/S3；支持进度与断点续传（大视频）。
  - 搜索与筛选：关键词、标签、宠物类型、排序；保留最近搜索与筛选偏好。
  - 实时：私信与通知采用 WebSocket；点赞/评论等轻实时采用乐观更新 + 后台对账。

## 后端实现（微服务拆分与接口）
- Auth & 用户
  - `POST /auth/login/weapp`（code2Session）/ `POST /auth/bind/phone` / `POST /auth/sms/login`
  - `GET/PUT /users/me`、`GET /users/:id`；头像、昵称、隐私设置。
  - 关注/粉丝/获赞：`POST/DELETE /follows/:targetId`、统计接口。
- 社区服务
  - 帖子：`GET /posts`（分页/筛选/话题）/ `POST /posts` / `PUT /posts/:id` / `DELETE /posts/:id`
  - 媒体：`POST /media/sign`（直传签名）/ `POST /media/callback`（落库）
  - 互动：`POST/DELETE /posts/:id/like`、`POST /posts/:id/comments`、收藏与分享统计
  - 话题与推荐：`GET /topics/hot`、`GET /feed/recommend`
  - 搜索：`GET /search/posts`（全文索引 + 标签过滤）
- 商城服务
  - 商品与分类：`GET /products` / `GET /products/:id` / `GET /categories`
  - 购物车：`GET /cart` / `POST /cart/items` / `PUT /cart/items/:id` / `DELETE /cart/items/:id`
  - 订单：`POST /orders` / `GET /orders` / `GET /orders/:id` / 取消/退款
  - 收藏商品：`POST/DELETE /favorites/products/:id`
- 宠物服务
  - 服务目录：`GET /services`（疫苗/美容/医疗/寄养）/ 机构与医生、美容师列表
  - 预约：`POST /appointments` / `GET /appointments` / 修改/取消 / 状态流转
  - 记录与评价：各服务记录查询与 `POST /appointments/:id/reviews`
- 消息与通知
  - 私信：`GET /messages` / `GET /conversations` / WebSocket 接入点
  - 系统通知：互动提醒、预约与订单状态变更；站内 + 模板消息可扩展
- 管理接口（用户端只透传，不开放操作）
  - 内容审核、商品与库存、服务排班、用户管理

## 数据库设计（核心表）
- 用户与关系：`users`、`user_profiles`、`pets`、`follows`、`likes`、`favorites`
- 社区：`posts`、`post_media`、`comments`、`topics`、`post_topics`、`search_index`
- 商城：`products`、`categories`、`product_skus`、`product_media`、`cart_items`、`orders`、`order_items`、`payments`、`refunds`
- 服务：`service_types`、`providers`、`schedules`、`appointments`、`appointment_reviews`、各类记录表（疫苗/美容/医疗/寄养）
- 行为与日志：`browse_history`、`notifications`、`message_threads`、`messages`
- 索引策略：主表覆盖二级索引（时间/用户/话题/分类），`posts.content` 与 `products` 文本字段建立 FULLTEXT；高阶搜索可预留 ES。

## 性能与安全
- 高并发：Nginx 反向代理 + Gunicorn 多进程；读写分离与连接池；热点数据 Redis 缓存 + 过期与失效策略。
- 快速响应：列表页骨架屏 + 分页；图片/视频 CDN；媒体懒加载与优先级加载。
- 稳定性：接口幂等、重试与熔断；消息队列（异步任务：索引、通知、审计）。
- 安全：JWT + CSRF 防护（仅 Web 侧）、输入/文件校验、限流与防刷；内容审核（敏感词与图片检测）。
- 隐私：用户数据最小化；隐私设置与黑名单；日志脱敏。

## 与设计稿的对齐
- 入口与导航：TabBar 四项与图标、色彩、字号按 MasterGo 与本地 `图片/` 素材一致。
- 关键页面：
  - 社区：主页、帖子详情、发布、搜索、私信与聊天，与 `社区@1x.png` 系列完全对位。
  - 商城：商品列表、详情、客服、购物车，与 `商城@1x.png` 系列对位。
  - 服务：疫苗预约、项目列表，与 `疫苗@1x.png` 对位；美容/医疗/寄养同构布局。
  - 我的：资料、设置，与 `我的@1x.png` 及 `我的 设置@1x.png` 对位。
- 组件样式：统一圆角与阴影、卡片信息密度、标签颜色、交互反馈与动效（加载、点赞波纹、提交成功）。

## 开发里程碑
- M1 基线：项目脚手架、登录与个人资料、全局网络层与错误态（1 周）
- M2 社区：浏览/详情/发布/点赞/评论/收藏/搜索、话题（2 周）
- M3 商城：分类/列表/详情、购物车、下单与订单流（2 周）
- M4 服务：目录/预约流程/记录与评价（2 周）
- M5 私信与通知：会话/聊天/Socket 接入、通知中心（1 周）
- M6 个人中心完善：宠物卡、历史、设置、数据统计（1 周）
- M7 优化与验收：性能、安全、稳定性、边界与可用性测试（1 周）

## 测试与验收
- 单元：服务层与工具函数；接口 Mock；上传与分页；权限校验。
- 集成：端到端关键流程（发帖、下单、预约、聊天）；弱网与断点续传。
- 数据：大量测试数据与并发模拟；Redis 与 MySQL 观察指标。
- 验收：对比设计稿像素级检查；关键路径可用性 >= 99%；核心接口 P95 响应 < 200ms（缓存命中）。

## 参考文献整理
- 从 `f:\PAWHome\论文` 选取至少 15 篇，含 2 篇英文，覆盖：微信小程序架构、Redis 高性能、社区与推荐、电商与订单、预约系统设计与并发、内容审核与隐私。
- 摘要关键结论，映射到本项目的技术与设计取舍（例如 Redis 客户端设计、移动端交互 UX）。

## 立即准备的交付物（确认后执行）
- 小程序工程初始化（TS + Vant Weapp + 基础 pages/组件）与 `app.json`/`sitemap.json`。
- 请求封装与鉴权拦截；错误页与空态组件。
- 页面骨架与路由：社区、商城、服务、我的；对位 MasterGo 设计稿。
- 服务契约文档（OpenAPI 草案）与 MySQL 初始建表脚本；Redis 键空间约定。
- 媒体上传与对象存储直传流程（后端签名 + 前端上传）。
- WebSocket 接入与心跳、掉线重连策略。

## 需要您的确认
- 是否采用 Vant Weapp 作为主 UI 库（保留 WeUI 少量组件）？
- 是否启用手机号验证码登录与微信登录并行（兼容“验证码登录|SSO登录”）？
- 对实时私信与互动通知采用 Socket + 乐观更新的方案是否满足？
- 是否接受先用 MySQL FULLTEXT 实现搜索，后期再接入 ES？
- 是否有指定的对象存储与 CDN（COS/OSS/S3）偏好？