# 项目概览与目标
- 目标：实现“基于手机系统的宠物信息交流平台微信小程序”的用户端与管理端能力，覆盖社区交流、商品购买、宠物服务、个人中心等模块，满足高并发、低延迟、稳定、安全要求。
- 角色：`用户`与`管理员`。用户完成浏览/发布/互动/购买/预约/管理宠物信息；管理员完成内容审核、商品管理、用户管理、服务预约管理。
- 执行方式：原生微信小程序 + TypeScript + Vant Weapp/WeUI；后端采用 Flask 微服务 + MySQL + Redis；统一网关与鉴权；严格文档与项目规则。

## UI对齐
- 参考：`https://mastergo.com/file/146159509284961` 与 `f:\PAWHome\UI设计` 中 PNG 与 PDF 原型。
- 页面矩阵（与现有素材对齐）：
  - `主页`、`社区`、`帖子详情`、`发布帖子`、`帖子搜索`、`个人主页`
  - `商城首页`、`商品详情`、`购物车`、`客服`、`订单列表/详情`
  - `疫苗`、`疫苗预约`、`美容`、`医疗`、`寄养`、`服务评价`
  - `我的`、`设置`（通知/隐私/账号安全）、`浏览历史`、`收藏`
- 设计规范：统一色板、字号、间距、栅格、组件变体；明确交互（加载、空态、错误、占位、骨架屏）。

## 总体架构
- 前端：原生小程序（TS），UI库倾向选用 `Vant Weapp`（表单、弹窗、列表、Tab、ActionSheet、Uploader、Skeleton 等）与 `WeUI`补充；状态管理使用轻量方案（全局 Store + 事件总线 或 `mobx-miniprogram`）。
- 后端：
  - `API 网关`：统一鉴权、路由、限流（Nginx/OpenResty），HTTPS。
  - 微服务拆分：`auth-service`、`user-service`、`social-service`、`content-service`、`shop-service`、`service-service`（预约/机构）、`admin-service`、`notification-service`。
  - 数据层：MySQL（主从或读写分离，InnoDB）、Redis（缓存、会话、计数、排行榜、消息路由）、对象存储（图片/视频，Cos/OSS/自建）。
  - 异步：Celery/RQ（推送、统计、推荐、清理任务）。
  - 实时：WebSocket（`wx.connectSocket`）或长轮询，用于私信与互动提醒。
- 鉴权：基于 `wx.login` + `code2Session` 获取 `openid/session_key/unionid`，服务端签发 `JWT`/`会话Token`；绑定手机号（短信验证码登录）与可选 SSO，对齐常见“验证码登录 | SSO 登录”的体验。
- 部署：容器化（Docker Compose/K8s），环境分层（dev/staging/prod），配置中心，灰度发布。

## 前端实现
- 项目结构：
  - `pages/`（页面路由）`components/`（复用组件）`services/`（API 封装）`stores/`（状态）`utils/`（工具）`types/`（TS类型）`assets/`（静态）`config/`（环境）
  - 路由与分包：社区、商城、服务、个人中心分包；首屏优化与按需加载。
- 能力要点：
  - 上传：图片/视频选择与压缩，断点续传与进度反馈。
  - 列表：分页/无限滚动，骨架屏，空态占位。
  - 搜索与筛选：关键字、标签、宠物类型、价格范围、距离等。
  - 可访问性与国际化（中文为主，预留 i18n）。
- SDK 封装：统一 `request` 拦截（签名、Token 注入、错误码处理、重试）、日志上报、埋点（曝光/点击/转化）。

## 后端微服务设计
- `auth-service`：code2Session、注册/登录、短信验证码、SSO、Token 刷新、权限校验、风控（滑块/图形验证码）。
- `user-service`：用户资料、头像、昵称、隐私设置、账号安全（设备/登录日志）、关注/粉丝/获赞计数。
- `content-service`：帖子 CRUD、媒体处理、标签/话题、全文检索（ES 可选）、推荐与热度计算、收藏/浏览历史。
- `social-service`：点赞、评论（楼中楼）、分享、私信（会话/消息/未读）、通知中心（系统/互动）。
- `shop-service`：商品/分类/品牌、SKU/库存、评价、购物车、订单/支付/退款、地址、优惠券。
- `service-service`：服务机构、服务类型（疫苗/美容/医疗/寄养）、预约/排班、订单与履约、评价。
- `admin-service`：内容审核（策略+人工）、用户/商品/服务管理、风控与申诉。
- `notification-service`：模板消息/订阅消息、站内信、WebSocket 推送、消息队列桥接。

## 数据库设计（ER 与表清单）
- 基础与用户：`user`、`role`、`permission`、`user_role`、`user_profile`、`user_settings`、`user_device`。
- 社交关系与内容：`pet`、`follow`、`post`、`post_media`、`tag`、`post_tag`、`topic`、`post_topic`、`like`、`comment`、`favorite`、`share`、`history`、`recommend_log`。
- 私信与通知：`dm_conversation`、`dm_message`、`notification`、`subscription`。
- 商城：`category`、`brand`、`product`、`sku`、`inventory`、`cart`、`cart_item`、`order`、`order_item`、`payment`、`refund`、`address`、`review`、`coupon`、`coupon_claim`。
- 服务预约：`service_org`、`service_type`、`service_item`、`schedule`、`appointment`、`service_order`、`service_record`、`rating`。
- 运维与安全：`audit_log`、`risk_event`、`ban_list`、`config_kv`。
- 设计要点：
  - 主键：自增ID（雪花ID可选）；外键约束与级联策略；软删除字段。
  - 索引：组合索引（`(user_id, created_at)`）、全文索引（ES/倒排）、唯一约束（`openid`、`phone`）。
  - 时序与统计：日活、互动、热度分；Redis 计数器 + 定时落库。

## 接口文档规范
- 标准：`OpenAPI 3.0`（YAML/JSON），分服务定义，集中在网关层聚合，生成可视化文档。
- 鉴权：`Authorization: Bearer <token>`；`x-wx-openid`/`x-device-id` 头；幂等键（支付/预约）。
- 错误码：
  - `0` 成功；`4001` 参数错误；`4003` 未授权；`4004` 资源不存在；`4090` 幂等冲突；`5000` 系统错误；`600x` 业务细分（如预约、库存）。
- 版本与兼容：`/api/v1` 前缀；弃用策略与变更日志。
- 参考对齐：遵循微信小程序开发官方文档与组件/API能力（框架、组件、API、云开发/云托管、开发者工具）。

## 图表交付（UML/流程/时序）
- 用例图：用户/管理员与社区/商城/服务/个人中心/审核的交互。
- 领域类图：用户/宠物/帖子/媒体/标签/话题/互动/订单/SKU/预约/机构 等实体与关系。
- 流程图：发帖流程、下单流程、服务预约流程、私信发送/未读处理、登录鉴权与会话续期。
- 时序图：点赞与计数更新、支付通知回调、预约确认/提醒、消息推送与确认。
- 交付格式：`PlantUML` 源文件 + `PNG/PDF` 输出，存放 `f:\PAWHome\输出文档`。

## 开发规范与项目规则
- 代码：TypeScript 严格模式；ESLint + Prettier；提交规范（Conventional Commits）。
- API：命名/路径/方法/状态码/分页/筛选/排序统一；幂等与重试；签名与防重放。
- 数据库：命名（`snake_case`）、字段类型/长度、索引策略、外键/约束、时间字段统一（`created_at/updated_at/deleted_at`）。
- 安全：输入校验、XSS/CSRF（小程序场景侧重 Token 与请求签名）、权限与越权防控、速率限制、对象存储访问策略、日志脱敏。
- UI：组件使用规范、响应式与适配、动效与过渡、可访问性、空态与错误态统一模板。
- 文档：需求/设计/接口/部署/测试；模板参考 `f:\PAWHome\格式参考`；统一导出 PDF。

## 参考文献整理
- 来源：`f:\PAWHome\论文` 目录的 15+ 篇资料与至少 2 篇英文文献（如 Vue.js+MySQL、Redis 高性能架构）。
- 体例：GB/T 7714 或 IEEE 风格；在设计文档与论文中统一引用。

## 里程碑与交付物
- M1 需求与UI对齐：页面清单、交互稿、组件清单；用例图初版。
- M2 数据库与API：ER图、表DDL草案、OpenAPI 草案；类图初版。
- M3 前端骨架：项目初始化、路由与分包、通用组件与SDK封装。
- M4 后端基础：鉴权/用户服务、网关、部署脚本；流程图初版。
- M5 社区模块：发帖/浏览/互动/搜索/私信；性能优化。
- M6 商城模块：商品/购物车/订单/支付/退款；风控与日志。
- M7 服务模块：机构/排班/预约/履约/评价；提醒与订阅消息。
- M8 个人中心：资料/宠物卡/收藏与历史/设置；数据一致性校验。
- M9 管理端与审核：策略库与人工审核、申诉与封禁。
- M10 测试与优化：单元/集成/E2E、压测与调优；文档定稿与导出。

## 验收与质量保障
- 指标：接口成功率、首屏时间、交互延时、错误率、Crash 率、资源加载耗时。
- 测试：覆盖率目标、Mock 环境、数据构造、灰度观察。
- 安全：鉴权/授权、风控、审计、备份与灾备；隐私合规（最小化采集、透明可控）。

——以上为完整实施计划。确认后我将按里程碑开始产出：数据库DDL与ER图、OpenAPI规范、UML图、页面骨架与组件库接入、后端微服务框架以及所有规范文档，并把最终文档落在 `f:\PAWHome\输出文档`。